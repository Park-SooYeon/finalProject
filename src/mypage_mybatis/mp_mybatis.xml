<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTDMapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypage">
	
   <insert id="insert_trip" parameterType="bean.TripListVo">
      <selectKey keyProperty="trip_list_serial" resultType="int" order="BEFORE">
         select seq_trip_list_serial.nextval
         from dual
       </selectKey>
      insert into trip_list(trip_list_serial, member_id, trip_name, days_count, start_date, end_date, trip_auth, trip_date) 
      values(#{trip_list_serial}, #{member_id}, #{trip_name}, ${days_count}, #{start_date,jdbcType=DATE}, #{end_date,jdbcType=DATE}, ${trip_auth}, sysdate)
   </insert>
	
	<select id="select_trip" resultType="bean.TripListVo">
		select 	trip_list_serial, 
				member_id, 
				trip_name, 
				days_count, 
				to_char(start_date,'rrrr/mm/dd') start_date, 
				to_char(end_date,'rrrr/mm/dd') end_date, 
				trip_auth, 
				trip_date 
				from trip_list
				order by trip_date desc
	</select>
	
	<update id="modify_trip" parameterType="bean.TripListVo">
		update trip_list set trip_name = #{trip_name}, 
							 days_count = ${days_count},
							 start_date = #{start_date,jdbcType=DATE},
							 end_date = #{end_date,jdbcType=DATE},
							 trip_auth = ${trip_auth}
							 where trip_list_serial = ${trip_list_serial}
	</update>
	
	<delete id="delete_trip" parameterType="Integer">
		delete from trip_list where trip_list_serial = ${_parameter}
	</delete>
	
	<insert id="insert_like" parameterType="bean.LikeListVo">
      insert into like_list(like_serial, member_id, trip_list_serial, place_serial, partner_serial) 
               values(seq_like_list.nextval, 
               		#{member_id}, 
               		${trip_list_serial}, 
               		${place_serial}, 
               		${partner_serial,jdbcType=NUMERIC} )
   </insert>
   
   <select id="select_like" parameterType="String" resultType="bean.LikeListVo">
   	select L.like_serial, 
   		   L.member_id, 
   		   T.trip_name, 
   		   P.place_name, 
   		   L.trip_list_serial 
   		   from trip_list T, place P, like_list L 
   		   where P.place_serial = L.place_serial 
   		   and T.trip_list_serial = L.trip_list_serial 
   		   and L.member_id = #{_parameter}
   </select>
   
   <select id="select_review" parameterType="String" resultType="bean.ReviewVo">
   		select like_serial,
   			   R.review_serial, 
   			   member_id, 
   			   (select place_name from place where place_serial = R.place_serial) place_name,  
   			   reputation, 
   			   review_title, 
   			   review_content
   		from review R join review_like L
   		on R.review_serial = L.review_serial
   		where like_id = #{_parameter}
   </select>
	
	
</mapper>